<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Verify a degree</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="css/style.css" />
    <style>
      body,
      * {
        font-family: "GE SS Unique", sans-serif !important;
      }
    </style>
  </head>
  <body class="bg-gradient-to-b from-gray-100 to-violet-200 min-h-screen">
    <!-- Navbar -->
    <div id="navbar-container"></div>
    <div
      class="max-w-5xl my-24 mx-auto bg-white rounded-2xl shadow-2xl p-10 border border-gray-100 flex flex-col items-center"
    >
      <h2 class="text-4xl font-bold text-violet-900 mb-8">Verify a degree</h2>
      <form id="verificationForm">
        <div class="flex flex-col gap-8">
          <div class="flex-1">
            <h3 class="text-2xl font-semibold text-violet-900 mb-4">
              Account Information
            </h3>

            <label class="block mb-4 text-lg font-medium text-violet-900"
              >First Name*<input
                type="text"
                name="firstName"
                required
                class="mt-1 w-full bg-white border border-violet-400 rounded-lg px-4 py-3 shadow-sm text-xl font-sans focus:outline-none focus:ring-2 focus:ring-violet-200 focus:border-violet-400 transition placeholder-violet-300"
            /></label>
            <label class="block mb-4 text-lg font-medium text-violet-900"
              >Last Name*<input
                type="text"
                name="lastName"
                required
                class="mt-1 w-full bg-white border border-violet-400 rounded-lg px-4 py-3 shadow-sm text-xl font-sans focus:outline-none focus:ring-2 focus:ring-violet-200 focus:border-violet-400 transition placeholder-violet-300"
            /></label>
            <label class="block mb-4 text-lg font-medium text-violet-900"
              >Candidate's date of birth*
              <div class="bg-gray-100 rounded-xl p-4 flex gap-4 items-end mt-2">
                <div class="flex flex-col flex-1">
                  <span class="text-xs text-gray-600 mb-1">Day</span>
                  <select
                    name="dob_day"
                    class="bg-white border border-violet-300 rounded-lg px-3 py-2 shadow-sm text-xl font-sans focus:outline-none focus:ring-2 focus:ring-violet-100 focus:border-violet-400 transition"
                  >
                    <option value="">-</option>
                    <!-- Days 1-31 -->
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="5">5</option>
                    <option value="6">6</option>
                    <option value="7">7</option>
                    <option value="8">8</option>
                    <option value="9">9</option>
                    <option value="10">10</option>
                    <option value="11">11</option>
                    <option value="12">12</option>
                    <option value="13">13</option>
                    <option value="14">14</option>
                    <option value="15">15</option>
                    <option value="16">16</option>
                    <option value="17">17</option>
                    <option value="18">18</option>
                    <option value="19">19</option>
                    <option value="20">20</option>
                    <option value="21">21</option>
                    <option value="22">22</option>
                    <option value="23">23</option>
                    <option value="24">24</option>
                    <option value="25">25</option>
                    <option value="26">26</option>
                    <option value="27">27</option>
                    <option value="28">28</option>
                    <option value="29">29</option>
                    <option value="30">30</option>
                    <option value="31">31</option>
                  </select>
                </div>
                <div class="flex flex-col flex-1">
                  <span class="text-xs text-gray-600 mb-1">Month</span>
                  <select
                    name="dob_month"
                    class="bg-white border border-violet-300 rounded-lg px-3 py-2 shadow-sm text-xl font-sans focus:outline-none focus:ring-2 focus:ring-violet-100 focus:border-violet-400 transition"
                  >
                    <option value="">-</option>
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="5">5</option>
                    <option value="6">6</option>
                    <option value="7">7</option>
                    <option value="8">8</option>
                    <option value="9">9</option>
                    <option value="10">10</option>
                    <option value="11">11</option>
                    <option value="12">12</option>
                  </select>
                </div>
                <div class="flex flex-col flex-1">
                  <span class="text-xs text-gray-600 mb-1">Year (yyyy)</span>
                  <input
                    type="text"
                    name="dob_year"
                    maxlength="4"
                    placeholder="yyyy"
                    class="bg-white border border-violet-300 rounded-lg px-3 py-2 shadow-sm text-xl font-sans focus:outline-none focus:ring-2 focus:ring-violet-100 focus:border-violet-400 transition"
                  />
                </div>
              </div>
            </label>
            <label class="block mb-4 text-lg font-medium text-violet-900"
              >Candidate email<input
                type="email"
                name="candidateEmail"
                class="mt-1 w-full bg-white border border-violet-400 rounded-lg px-4 py-3 shadow-sm text-xl font-sans focus:outline-none focus:ring-2 focus:ring-violet-200 focus:border-violet-400 transition placeholder-violet-300"
            /></label>
            <label class="block mb-4 text-lg font-medium text-violet-900"
              >Address<input
                type="text"
                name="address"
                class="mt-1 w-full bg-white border border-violet-400 rounded-lg px-4 py-3 shadow-sm text-xl font-sans focus:outline-none focus:ring-2 focus:ring-violet-200 focus:border-violet-400 transition placeholder-violet-300"
            /></label>
            <label class="block mb-4 text-lg font-medium text-violet-900"
              >Candidate phone number<input
                type="tel"
                name="phone"
                class="mt-1 w-full bg-white border border-violet-400 rounded-lg px-4 py-3 shadow-sm text-xl font-sans focus:outline-none focus:ring-2 focus:ring-violet-200 focus:border-violet-400 transition placeholder-violet-300"
            /></label>
          </div>
          <div class="flex-1">
            <h3 class="text-2xl font-semibold text-violet-900 mb-4">Program</h3>
            <label class="block mb-4 text-lg font-medium text-violet-900"
              >Country*
              <select
                name="country"
                required
                class="mt-1 w-full bg-white border border-violet-500 rounded-lg px-4 py-3 shadow-sm text-xl font-sans focus:outline-none focus:ring-2 focus:ring-violet-300 focus:border-violet-500 transition"
              >
                <option value="">Select Country</option>
                <option value="France">France</option>
                <option value="Germany">Germany</option>
                <option value="Italy">Italy</option>
                <option value="Spain">Spain</option>
                <option value="United Kingdom">United Kingdom</option>
                <option value="United States">United States</option>
                <option value="Canada">Canada</option>
                <option value="Australia">Australia</option>
                <option value="Japan">Japan</option>
                <option value="China">China</option>
              </select>
            </label>
            <label class="block mb-4 text-lg font-medium text-violet-900"
              >Establishment*
              <select
                name="establishment"
                required
                class="mt-1 w-full bg-white border border-violet-500 rounded-lg px-4 py-3 shadow-sm text-xl font-sans focus:outline-none focus:ring-2 focus:ring-violet-300 focus:border-violet-500 transition"
              >
                <option value="">Select Establishment</option>
                <option value="University of Paris">University of Paris</option>
                <option value="Sorbonne University">Sorbonne University</option>
                <option value="École Polytechnique">École Polytechnique</option>
                <option value="HEC Paris">HEC Paris</option>
                <option value="Sciences Po">Sciences Po</option>
                <option value="École Normale Supérieure">
                  École Normale Supérieure
                </option>
                <option value="University of Lyon">University of Lyon</option>
                <option value="University of Strasbourg">
                  University of Strasbourg
                </option>
                <option value="University of Bordeaux">
                  University of Bordeaux
                </option>
                <option value="University of Lille">University of Lille</option>
              </select>
            </label>
            <label class="block mb-4 text-lg font-medium text-violet-900"
              >Program*
              <select
                name="program"
                required
                class="mt-1 w-full bg-white border border-violet-500 rounded-lg px-4 py-3 shadow-sm text-xl font-sans focus:outline-none focus:ring-2 focus:ring-violet-300 focus:border-violet-500 transition"
              >
                <option value="">Select Program</option>
                <option value="Bachelor of Science">Bachelor of Science</option>
                <option value="Bachelor of Arts">Bachelor of Arts</option>
                <option value="Master of Science">Master of Science</option>
                <option value="Master of Arts">Master of Arts</option>
                <option value="Master of Business Administration">
                  Master of Business Administration
                </option>
                <option value="Doctor of Philosophy">
                  Doctor of Philosophy
                </option>
                <option value="Bachelor of Engineering">
                  Bachelor of Engineering
                </option>
                <option value="Master of Engineering">
                  Master of Engineering
                </option>
                <option value="Bachelor of Computer Science">
                  Bachelor of Computer Science
                </option>
                <option value="Master of Computer Science">
                  Master of Computer Science
                </option>
              </select>
            </label>
            <label class="block mb-4 text-lg font-medium text-violet-900"
              >Graduation Year*
              <select
                name="graduationYear"
                required
                class="mt-1 w-full bg-white border border-violet-500 rounded-lg px-4 py-3 shadow-sm text-xl font-sans focus:outline-none focus:ring-2 focus:ring-violet-300 focus:border-violet-500 transition"
              >
                <option value="">Select Year</option>
                <option value="2024">2024</option>
                <option value="2023">2023</option>
                <option value="2022">2022</option>
                <option value="2021">2021</option>
                <option value="2020">2020</option>
                <option value="2019">2019</option>
                <option value="2018">2018</option>
                <option value="2017">2017</option>
                <option value="2016">2016</option>
                <option value="2015">2015</option>
                <option value="2014">2014</option>
                <option value="2013">2013</option>
                <option value="2012">2012</option>
                <option value="2011">2011</option>
                <option value="2010">2010</option>
              </select>
            </label>
            <label class="block mb-4 text-lg font-medium text-violet-900"
              >Your Internal Reference
              <input
                type="text"
                name="reference"
                class="mt-1 w-full bg-white border border-violet-400 rounded-lg px-4 py-3 shadow-sm text-xl font-sans focus:outline-none focus:ring-2 focus:ring-violet-200 focus:border-violet-400 transition placeholder-violet-300"
              />
            </label>
          </div>
        </div>
        <hr class="my-8 border-violet-700" />
        <div class="mb-8">
          <h3 class="text-2xl font-semibold text-violet-900 mb-4">Documents</h3>
          <div class="flex flex-col md:flex-row gap-6 justify-between">
            <div class="flex-1 text-center">
              <span class="block font-bold mb-2 text-violet-900"
                >Consent form*</span
              >
              <div
                class="bg-white/60 border-2 border-violet-400 rounded-xl p-6 flex flex-col items-center justify-center min-h-[180px] shadow-md"
              >
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  class="h-12 w-12 text-violet-700 mb-2"
                  fill="none"
                  viewBox="0 0 24 24"
                  stroke="currentColor"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M7 16v-4a4 4 0 018 0v4m-4-4v8m0 0H5a2 2 0 01-2-2v-2a2 2 0 012-2h14a2 2 0 012 2v2a2 2 0 01-2 2h-6z"
                  />
                </svg>
                <label
                  class="cursor-pointer text-violet-600 font-semibold hover:underline"
                >
                  Select a file to upload
                  <input
                    type="file"
                    name="consentForm"
                    required
                    class="hidden"
                  />
                </label>
                <div class="text-xs text-gray-500 mt-2">
                  PDF, JPG, PNG, TIF. Up to 5MB.
                </div>
              </div>
            </div>
            <div class="flex-1 text-center">
              <span class="block font-bold mb-2 text-violet-900"
                >Degree holder's ID</span
              >
              <div
                class="bg-white/60 border-2 border-violet-400 rounded-xl p-6 flex flex-col items-center justify-center min-h-[180px] shadow-md"
              >
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  class="h-12 w-12 text-violet-700 mb-2"
                  fill="none"
                  viewBox="0 0 24 24"
                  stroke="currentColor"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M7 16v-4a4 4 0 018 0v4m-4-4v8m0 0H5a2 2 0 01-2-2v-2a2 2 0 012-2h14a2 2 0 012 2v2a2 2 0 01-2 2h-6z"
                  />
                </svg>
                <label
                  class="cursor-pointer text-violet-600 font-semibold hover:underline"
                >
                  Select a file to upload
                  <input type="file" name="degreeId" class="hidden" />
                </label>
                <div class="text-xs text-gray-500 mt-2">
                  PDF, JPG, PNG, TIF. Up to 5MB.
                </div>
              </div>
            </div>
            <div class="flex-1 text-center">
              <span class="block font-bold mb-2 text-violet-900"
                >Copy of the diploma</span
              >
              <div
                class="bg-white/60 border-2 border-violet-400 rounded-xl p-6 flex flex-col items-center justify-center min-h-[180px] shadow-md"
              >
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  class="h-12 w-12 text-violet-700 mb-2"
                  fill="none"
                  viewBox="0 0 24 24"
                  stroke="currentColor"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M7 16v-4a4 4 0 018 0v4m-4-4v8m0 0H5a2 2 0 01-2-2v-2a2 2 0 012-2h14a2 2 0 012 2v2a2 2 0 01-2 2h-6z"
                  />
                </svg>
                <label
                  class="cursor-pointer text-violet-600 font-semibold hover:underline"
                >
                  Select a file to upload
                  <input type="file" name="diplomaCopy" class="hidden" />
                </label>
                <div class="text-xs text-gray-500 mt-2">
                  PDF, JPG, PNG, TIF. Up to 5MB.
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="flex flex-col md:flex-row gap-6 mb-6">
          <div class="flex-1">
            <label class="block text-lg font-medium text-violet-900"
              >Company<input
                type="text"
                name="company"
                class="mt-1 w-full bg-white border border-violet-400 rounded-lg px-4 py-3 shadow-sm text-xl font-sans focus:outline-none focus:ring-2 focus:ring-violet-200 focus:border-violet-400 transition placeholder-violet-300"
            /></label>
          </div>
          <div class="flex-1">
            <label class="block text-lg font-medium text-violet-900"
              >Contact<input
                type="text"
                name="contact"
                class="mt-1 w-full bg-white border border-violet-400 rounded-lg px-4 py-3 shadow-sm text-xl font-sans focus:outline-none focus:ring-2 focus:ring-violet-200 focus:border-violet-400 transition placeholder-violet-300"
            /></label>
          </div>
          <div class="flex-1">
            <label class="block text-lg font-medium text-violet-900"
              >E-mail address<input
                type="email"
                name="contactEmail"
                class="mt-1 w-full bg-white border border-violet-400 rounded-lg px-4 py-3 shadow-sm text-xl font-sans focus:outline-none focus:ring-2 focus:ring-violet-200 focus:border-violet-400 transition placeholder-violet-300"
            /></label>
          </div>
        </div>
        <div class="mb-6">
          <label class="block text-lg font-medium text-violet-900"
            >Comment
            <input
              type="text"
              name="comment"
              class="mt-1 w-full bg-white border border-violet-400 rounded-lg px-4 py-3 shadow-sm text-xl font-sans focus:outline-none focus:ring-2 focus:ring-violet-200 focus:border-violet-400 transition placeholder-violet-300"
            />
          </label>
        </div>
        <div class="flex justify-between">
          <button
            type="button"
            onclick="saveDraft()"
            class="border-2 border-violet-900 text-violet-900 bg-transparent px-6 py-3 rounded-lg font-bold text-lg hover:bg-violet-800 hover:text-white transition-colors"
          >
            Save the verification in Drafts
          </button>
          <button
            type="submit"
            class="bg-violet-800 text-white px-6 py-3 rounded-lg font-bold text-lg hover:bg-violet-900 transition-colors"
          >
            Submit the verification
          </button>
        </div>
      </form>
    </div>
    <!-- Footer -->
    <div id="footer-container"></div>

    <script src="js/script.js"></script>
    <script>
      fetch("./navbar.html")
        .then((response) => response.text())
        .then((data) => {
          document.getElementById("navbar-container").innerHTML = data;
          // Initialize navbar functionality
          loadNavbar();
        });
      fetch("footer.html")
        .then((response) => response.text())
        .then((data) => {
          document.getElementById("footer-container").innerHTML = data;
        });
    </script>
    <script>
      // Helper function to show error messages (assuming this exists or is added elsewhere)
      function showError(element, message) {
        // Basic implementation: create a div and insert it after the element
        const errorDiv = document.createElement("div");
        errorDiv.classList.add(
          "error-message",
          "text-red-500",
          "text-sm",
          "mt-1"
        );
        errorDiv.textContent = message;
        // Find the parent element that contains the label or input
        const parent = element.closest("label") || element.parentElement;
        if (parent) {
          parent.appendChild(errorDiv);
        } else {
          element.parentElement.appendChild(errorDiv);
        }
      }

      // Form validation functions
      function validateName(name) {
        return name.length >= 2 && /^[\u0600-\u06FFa-zA-Z\s]+$/.test(name);
      }

      function validateEmail(email) {
        return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
      }

      function validatePhone(phone) {
        return /^[0-9+\s-]{8,}$/.test(phone);
      }

      function validateDateOfBirth(day, month, year) {
        if (!day || !month || !year) return false;
        const date = new Date(year, month - 1, day);
        return date instanceof Date && !isNaN(date);
      }

      function validateFile(file, maxSize = 5 * 1024 * 1024) {
        if (!file) return true; // Optional files
        const validTypes = [
          "application/docx",
          "image/jpeg",
          "image/png",
          "application/pdf",
        ];
        return validTypes.includes(file.type) && file.size <= maxSize;
      }

      async function submitVerification() {
        // الحصول على عناصر النموذج
        const form = document.getElementById("verificationForm");
        const firstName = form.querySelector('input[name="firstName"]');
        const lastName = form.querySelector('input[name="lastName"]');
        const dobDay = form.querySelector('select[name="dob_day"]');
        const dobMonth = form.querySelector('select[name="dob_month"]');
        const dobYear = form.querySelector('input[name="dob_year"]');
        const email = form.querySelector('input[name="candidateEmail"]');
        const address = form.querySelector('input[name="address"]');
        const phone = form.querySelector('input[name="phone"]');
        const country = form.querySelector('select[name="country"]');
        const establishment = form.querySelector(
          'select[name="establishment"]'
        );
        const program = form.querySelector('select[name="program"]');
        const graduationYear = form.querySelector(
          'select[name="graduationYear"]'
        );
        const reference = form.querySelector('input[name="reference"]');
        const company = form.querySelector('input[name="company"]');
        const contact = form.querySelector('input[name="contact"]');
        const contactEmail = form.querySelector('input[name="contactEmail"]');
        const comment = form.querySelector('input[name="comment"]');
        const consentFormInput = form.querySelector(
          'input[name="consentForm"]'
        );
        const degreeIdInput = form.querySelector('input[name="degreeId"]');
        const diplomaCopyInput = form.querySelector(
          'input[name="diplomaCopy"]'
        );

        // إعداد رؤوس الطلب
        const myHeaders = new Headers();
        myHeaders.append(
          "Authorization",
          "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiI2ODI0ZmFjYWNlYmM4OTAyNmFlMWRlYWUiLCJpYXQiOjE3NDgxMjYyMDgsImV4cCI6MTc0ODEyOTgwOH0.fpew6bHpykpbk3SBYhm40bGc8R9qMo5hx7i6Bm4KLWg"
        ); // NOTE: Hardcoded token - consider a more secure method

        // إنشاء FormData وإضافة البيانات
        const formdata = new FormData();
        formdata.append("firstName", firstName.value);
        formdata.append("lastName", lastName.value);
        formdata.append("birthDateDay", dobDay.value);
        formdata.append("birthDateMonth", dobMonth.value);
        formdata.append("birthDateYear", dobYear.value);
        formdata.append("email", email.value);
        formdata.append("address", address.value);
        formdata.append("phone", phone.value);
        formdata.append("country", country.value);
        formdata.append("establishment", establishment.value);
        formdata.append("program", program.value);
        formdata.append("graduationYear", graduationYear.value);
        formdata.append("internalRef", reference.value);
        formdata.append("company", company.value);
        formdata.append("contact", contact.value);
        formdata.append("contactEmail", contactEmail.value);
        formdata.append("comment", comment.value);

        // إضافة الملفات إذا تم اختيارها
        if (consentFormInput.files.length > 0) {
          formdata.append("consentForm", consentFormInput.files[0]);
        }
        if (degreeIdInput.files.length > 0) {
          formdata.append("idCard", degreeIdInput.files[0]);
        }
        if (diplomaCopyInput.files.length > 0) {
          formdata.append("diploma", diplomaCopyInput.files[0]);
        }

        // إعداد خيارات الطلب
        const requestOptions = {
          method: "POST",
          headers: myHeaders,
          body: formdata,
          redirect: "follow",
        };

        try {
          // Show loading state
          const submitButton = document.querySelector('button[type="submit"]');
          const originalButtonText = submitButton.textContent;
          submitButton.disabled = true;
          submitButton.innerHTML =
            '<i class="fas fa-spinner fa-spin"></i> جاري الإرسال...';

          // إرسال الطلب
          const response = await fetch(
            "https://backend-production-816c.up.railway.app/api/requests",
            requestOptions
          );
          const result = await response.json();

          if (response.ok) {
            alert("تم إرسال طلب التحقق بنجاح!");
            form.reset(); // إعادة تعيين النموذج بعد الإرسال الناجح
          } else {
            alert(
              result.message || "فشل في إرسال الطلب. يرجى المحاولة مرة أخرى."
            );
          }
        } catch (error) {
          console.error("Error:", error);
          alert("خطأ في الشبكة. يرجى التحقق من اتصالك والمحاولة مرة أخرى.");
        } finally {
          // Re-enable button and restore text
          const submitButton = document.querySelector('button[type="submit"]');
          submitButton.disabled = false;
          submitButton.innerHTML = "Submit the verification"; // Or the original text if stored
        }
      }

      // ربط الوظيفة بحدث submit للنموذج
      document
        .getElementById("verificationForm")
        .addEventListener("submit", function (e) {
          e.preventDefault();

          // Reset previous error messages
          document
            .querySelectorAll(".error-message")
            .forEach((el) => el.remove());

          let hasErrors = false;

          // Validate First Name
          const firstName = document.querySelector('input[name="firstName"]');
          if (!validateName(firstName.value)) {
            showError(
              firstName,
              "الرجاء إدخال الاسم الأول بشكل صحيح (حروف فقط)"
            );
            hasErrors = true;
          }

          // Validate Last Name
          const lastName = document.querySelector('input[name="lastName"]');
          if (!validateName(lastName.value)) {
            showError(
              lastName,
              "الرجاء إدخال الاسم الأخير بشكل صحيح (حروف فقط)"
            );
            hasErrors = true;
          }

          // Validate Date of Birth
          const dobDay = document.querySelector('select[name="dob_day"]');
          const dobMonth = document.querySelector('select[name="dob_month"]');
          const dobYear = document.querySelector('input[name="dob_year"]');
          if (
            !validateDateOfBirth(dobDay.value, dobMonth.value, dobYear.value)
          ) {
            showError(dobYear, "الرجاء إدخال تاريخ الميلاد بشكل صحيح"); // Link error to year input
            hasErrors = true;
          }

          // Validate Email if provided
          const email = document.querySelector('input[name="candidateEmail"]');
          if (email.value && !validateEmail(email.value)) {
            showError(email, "الرجاء إدخال البريد الإلكتروني بشكل صحيح");
            hasErrors = true;
          }

          // Validate Phone if provided
          const phone = document.querySelector('input[name="phone"]');
          if (phone.value && !validatePhone(phone.value)) {
            showError(phone, "الرجاء إدخال رقم الهاتف بشكل صحيح");
            hasErrors = true;
          }

          // Validate Required Selects
          const country = document.querySelector('select[name="country"]');
          const establishment = document.querySelector(
            'select[name="establishment"]'
          );
          const program = document.querySelector('select[name="program"]');
          const graduationYear = document.querySelector(
            'select[name="graduationYear"]'
          );

          if (!country.value) {
            showError(country, "الرجاء اختيار الدولة");
            hasErrors = true;
          }
          if (!establishment.value) {
            showError(establishment, "الرجاء اختيار المؤسسة");
            hasErrors = true;
          }
          if (!program.value) {
            showError(program, "الرجاء اختيار البرنامج");
            hasErrors = true;
          }
          if (!graduationYear.value) {
            showError(graduationYear, "الرجاء اختيار سنة التخرج");
            hasErrors = true;
          }

          // Validate Required Files
          const consentFormInput = document.querySelector(
            'input[name="consentForm"]'
          );
          if (consentFormInput.files.length === 0) {
            showError(
              consentFormInput.parentElement,
              "الرجاء تحميل نموذج الموافقة"
            );
            hasErrors = true;
          } else if (!validateFile(consentFormInput.files[0])) {
            showError(
              consentFormInput.parentElement,
              "الرجاء تحميل نموذج الموافقة بصيغة صحيحة (PDF, JPG, PNG, TIF) وحجم لا يتجاوز 5MB"
            );
            hasErrors = true;
          }

          // Validate Optional Files
          const degreeIdInput = document.querySelector(
            'input[name="degreeId"]'
          );
          if (
            degreeIdInput.files.length > 0 &&
            !validateFile(degreeIdInput.files[0])
          ) {
            showError(
              degreeIdInput.parentElement,
              "الرجاء تحميل بطاقة الهوية بصيغة صحيحة (PDF, JPG, PNG, TIF) وحجم لا يتجاوز 5MB"
            );
            hasErrors = true;
          }

          const diplomaCopyInput = document.querySelector(
            'input[name="diplomaCopy"]'
          );
          if (
            diplomaCopyInput.files.length > 0 &&
            !validateFile(diplomaCopyInput.files[0])
          ) {
            showError(
              diplomaCopyInput.parentElement,
              "الرجاء تحميل نسخة الدبلوم بصيغة صحيحة (PDF, JPG, PNG, TIF) وحجم لا يتجاوز 5MB"
            );
            hasErrors = true;
          }

          if (hasErrors) {
            return;
          }

          submitVerification();
        });

      // Helper function to save as draft
      function saveDraft() {
        const form = document.getElementById("verificationForm");
        const formData = new FormData(form);
        const draftData = {};
        for (let [key, value] of formData.entries()) {
          if (value instanceof File) {
            // Handle files differently if needed, e.g., store file names or indicators
            draftData[key] = value.name; // Storing file name as an example
          } else {
            draftData[key] = value;
          }
        }
        localStorage.setItem("verificationDraft", JSON.stringify(draftData));
        alert("تم حفظ المسودة بنجاح");
      }

      // Load draft if exists
      window.addEventListener("load", function () {
        const savedDraft = localStorage.getItem("verificationDraft");
        if (savedDraft) {
          const draftData = JSON.parse(savedDraft);
          Object.keys(draftData).forEach((key) => {
            const element = document.querySelector(`[name="${key}"]`);
            if (element && element.type !== "file") {
              element.value = draftData[key];
            } else if (element && element.type === "file") {
              // Cannot restore file input value directly for security reasons
              console.log(
                `Draft includes a file for ${key}: ${draftData[key]}. User needs to re-upload.`
              );
              // Optionally, display a message to the user to re-upload the file
            }
          });
        }
      });
    </script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    />
  </body>
</html>
