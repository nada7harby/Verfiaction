<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Verify a degree</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="css/style.css" />
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
      body,
      * {
        font-family: "GE SS Unique", sans-serif !important;
      }
      #mainContent {
        display: none;
      }
    </style>
    <script>
      // Check authentication on page load
      window.addEventListener("load", function () {
        const token = sessionStorage.getItem("authToken");
        if (!token) {
          Swal.fire({
            title: "Authentication Required",
            text: "Please login to access this page",
            icon: "warning",
            confirmButtonText: "Login",
            confirmButtonColor: "#7e22ce",
          }).then((result) => {
            if (result.isConfirmed) {
              window.location.href = "login.html";
            } else {
              window.location.href = "login.html";
            }
          });
        } else {
          document.getElementById("mainContent").style.display = "block";
        }
      });
    </script>
  </head>
  <body class="bg-gradient-to-b from-gray-100 to-violet-200 min-h-screen">
    <div id="mainContent">
      <!-- Navbar -->
  
    <!-- Navbar -->
    <div
      class="w-full bg-white shadow-[0_4px_24px_0_rgba(80,80,180,0.10)] fixed top-0 left-0 right-0 z-50"
      style="margin-top: 0"
    >
      <nav
        class="glass py-3 shadow-none w-full max-w-6xl mx-auto bg-white"
        style="text-align: center"
      >
        <div class="flex items-center justify-between w-full">
          <!-- Logo and Site Name (far left) -->
          <div class="flex items-center gap-3 min-w-0">
            <img
              src="images/logo-removebg-preview.png"
              alt="SPATRAK Logo"
              class="h-12 w-12 object-contain"
              onerror="this.src='https://via.placeholder.com/48'"
            />
            <span
              class="text-2xl font-bold text-violet-900 tracking-wide whitespace-nowrap"
              >SPATRAK</span
            >
          </div>
          <!-- Desktop Centered Navigation Links -->
          <div id="nav-menu" class="hidden md:flex gap-6 items-center mx-auto">
            <a
              href="index.html"
              class="text-violet-900 font-semibold hover:text-violet-700 hover:bg-violet-100 px-3 py-2 rounded transition"
              >Home</a
            >

            <a
              href="verify.html"
              class="text-violet-900 font-semibold hover:text-violet-700 hover:bg-violet-100 px-3 py-2 rounded transition"
              >Verify</a
            >

        
            <a
              href="terms.html"
              class="text-violet-900 font-semibold hover:text-violet-700 hover:bg-violet-100 px-3 py-2 rounded transition"
              >Conditions</a
            >
          </div>
          <!-- Hamburger for mobile (far right) -->
          <div class="md:hidden flex items-center ml-auto">
            <button id="nav-toggle" class="text-violet-900 focus:outline-none">
              <svg
                class="w-8 h-8"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M4 6h16M4 12h16M4 18h16"
                ></path>
              </svg>
            </button>
          </div>
          <!-- Desktop User Avatar Dropdown (far right) -->
          <div class="relative group ml-4 hidden md:block">
            <button
              id="avatar-dropdown-btn"
              class="focus:outline-none flex items-center"
            >
              <img
                src="images/Sample_User_Icon.png"
                alt="User"
                class="h-10 w-10 rounded-full border-2 border-violet-300 shadow-sm"
                onerror="this.src='images/Sample_User_Icon.png'"
              />
              <svg
                class="w-4 h-4 ml-2 text-violet-900"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M19 9l-7 7-7-7"
                ></path>
              </svg>
            </button>
            <div
              id="avatar-dropdown-menu"
              class="absolute right-0 mt-2 w-40 bg-white rounded-lg shadow-lg border border-gray-100 opacity-0 invisible group-hover:opacity-100 group-hover:visible group-focus:opacity-100 group-focus:visible transition-opacity duration-200 z-50"
            >
              <!-- Menu items will be populated by JavaScript -->
            </div>
          </div>
        </div>
        <!-- Mobile Menu: links + user dropdown inside -->
        <div id="mobile-menu" class="hidden flex-col gap-2 mt-4">
          <a
            href="index.html"
            class="block text-violet-900 font-semibold hover:text-violet-700 hover:bg-violet-100 px-3 py-2 rounded transition"
            >Home</a
          >

          <a
            href="verify.html"
            class="block text-violet-900 font-semibold hover:text-violet-700 hover:bg-violet-100 px-3 py-2 rounded transition"
            >Verify</a
          >

        
          <a
            href="terms.html"
            class="block text-violet-900 font-semibold hover:text-violet-700 hover:bg-violet-100 px-3 py-2 rounded transition"
            >Terms and Conditions</a
          >
          <div class="border-t border-violet-100 my-2"></div>
          <div id="mobile-user-section">
            <!-- Mobile user section will be populated by JavaScript -->
          </div>
        </div>
      </nav>
    </div>

      <div
        class="max-w-5xl my-24 mx-auto bg-white rounded-2xl shadow-2xl p-10 border border-gray-100 flex flex-col items-center"
      >
        <h2 class="text-4xl font-bold text-violet-900 mb-8">Verify a degree</h2>
        <form id="verificationForm" method="POST" enctype="multipart/form-data">
          <div class="flex flex-col gap-8">
            <div class="flex-1">
              <h3 class="text-2xl font-semibold text-violet-900 mb-4">
                Account Information
              </h3>

              <label class="block mb-4 text-lg font-medium text-violet-900"
                >First Name*<input
                  type="text"
                  name="firstName"
                  required
                  class="mt-1 w-full bg-white border border-violet-400 rounded-lg px-4 py-3 shadow-sm text-xl font-sans focus:outline-none focus:ring-2 focus:ring-violet-200 focus:border-violet-400 transition placeholder-violet-300"
              /></label>
              <label class="block mb-4 text-lg font-medium text-violet-900"
                >Last Name*<input
                  type="text"
                  name="lastName"
                  required
                  class="mt-1 w-full bg-white border border-violet-400 rounded-lg px-4 py-3 shadow-sm text-xl font-sans focus:outline-none focus:ring-2 focus:ring-violet-200 focus:border-violet-400 transition placeholder-violet-300"
              /></label>
              <label class="block mb-4 text-lg font-medium text-violet-900"
                >Candidate's date of birth*
                <div
                  class="bg-gray-100 rounded-xl p-4 flex gap-4 items-end mt-2"
                >
                  <div class="flex flex-col flex-1">
                    <span class="text-xs text-gray-600 mb-1">Day</span>
                    <select
                      name="dob_day"
                      class="bg-white border border-violet-300 rounded-lg px-3 py-2 shadow-sm text-xl font-sans focus:outline-none focus:ring-2 focus:ring-violet-100 focus:border-violet-400 transition"
                    >
                      <option value="">-</option>
                      <!-- Days 1-31 -->
                      <option value="1">1</option>
                      <option value="2">2</option>
                      <option value="3">3</option>
                      <option value="4">4</option>
                      <option value="5">5</option>
                      <option value="6">6</option>
                      <option value="7">7</option>
                      <option value="8">8</option>
                      <option value="9">9</option>
                      <option value="10">10</option>
                      <option value="11">11</option>
                      <option value="12">12</option>
                      <option value="13">13</option>
                      <option value="14">14</option>
                      <option value="15">15</option>
                      <option value="16">16</option>
                      <option value="17">17</option>
                      <option value="18">18</option>
                      <option value="19">19</option>
                      <option value="20">20</option>
                      <option value="21">21</option>
                      <option value="22">22</option>
                      <option value="23">23</option>
                      <option value="24">24</option>
                      <option value="25">25</option>
                      <option value="26">26</option>
                      <option value="27">27</option>
                      <option value="28">28</option>
                      <option value="29">29</option>
                      <option value="30">30</option>
                      <option value="31">31</option>
                    </select>
                  </div>
                  <div class="flex flex-col flex-1">
                    <span class="text-xs text-gray-600 mb-1">Month</span>
                    <select
                      name="dob_month"
                      class="bg-white border border-violet-300 rounded-lg px-3 py-2 shadow-sm text-xl font-sans focus:outline-none focus:ring-2 focus:ring-violet-100 focus:border-violet-400 transition"
                    >
                      <option value="">-</option>
                      <option value="1">1</option>
                      <option value="2">2</option>
                      <option value="3">3</option>
                      <option value="4">4</option>
                      <option value="5">5</option>
                      <option value="6">6</option>
                      <option value="7">7</option>
                      <option value="8">8</option>
                      <option value="9">9</option>
                      <option value="10">10</option>
                      <option value="11">11</option>
                      <option value="12">12</option>
                    </select>
                  </div>
                  <div class="flex flex-col flex-1">
                    <span class="text-xs text-gray-600 mb-1">Year (yyyy)</span>
                    <input
                      type="text"
                      name="dob_year"
                      maxlength="4"
                      placeholder="yyyy"
                      class="bg-white border border-violet-300 rounded-lg px-3 py-2 shadow-sm text-xl font-sans focus:outline-none focus:ring-2 focus:ring-violet-100 focus:border-violet-400 transition"
                    />
                  </div>
                </div>
              </label>
              <label class="block mb-4 text-lg font-medium text-violet-900"
                >Candidate email<input
                  type="email"
                  name="candidateEmail"
                  class="mt-1 w-full bg-white border border-violet-400 rounded-lg px-4 py-3 shadow-sm text-xl font-sans focus:outline-none focus:ring-2 focus:ring-violet-200 focus:border-violet-400 transition placeholder-violet-300"
              /></label>
              <label class="block mb-4 text-lg font-medium text-violet-900"
                >Address<input
                  type="text"
                  name="address"
                  class="mt-1 w-full bg-white border border-violet-400 rounded-lg px-4 py-3 shadow-sm text-xl font-sans focus:outline-none focus:ring-2 focus:ring-violet-200 focus:border-violet-400 transition placeholder-violet-300"
              /></label>
              <label class="block mb-4 text-lg font-medium text-violet-900"
                >Candidate phone number<input
                  type="tel"
                  name="phone"
                  class="mt-1 w-full bg-white border border-violet-400 rounded-lg px-4 py-3 shadow-sm text-xl font-sans focus:outline-none focus:ring-2 focus:ring-violet-200 focus:border-violet-400 transition placeholder-violet-300"
              /></label>
            </div>
            <div class="flex-1">
              <h3 class="text-2xl font-semibold text-violet-900 mb-4">
                Program
              </h3>
              <label class="block mb-4 text-lg font-medium text-violet-900"
                >Country*
                <select
                  name="country"
                  required
                  class="mt-1 w-full bg-white border border-violet-500 rounded-lg px-4 py-3 shadow-sm text-xl font-sans focus:outline-none focus:ring-2 focus:ring-violet-300 focus:border-violet-500 transition"
                >
                  <option value="">Select Country</option>
                  <option value="France">France</option>
                  <option value="Germany">Germany</option>
                  <option value="Italy">Italy</option>
                  <option value="Spain">Spain</option>
                  <option value="United Kingdom">United Kingdom</option>
                  <option value="United States">United States</option>
                  <option value="Canada">Canada</option>
                  <option value="Australia">Australia</option>
                  <option value="Japan">Japan</option>
                  <option value="China">China</option>
                </select>
              </label>
              <label class="block mb-4 text-lg font-medium text-violet-900"
                >Establishment*
                <input
                  type="text"
                  name="establishment"
                  required
                  placeholder="Enter establishment name (e.g., University of Paris)"
                  class="mt-1 w-full bg-white border border-violet-400 rounded-lg px-4 py-3 shadow-sm text-xl font-sans focus:outline-none focus:ring-2 focus:ring-violet-200 focus:border-violet-400 transition placeholder-violet-300"
                />
              </label>
              <label class="block mb-4 text-lg font-medium text-violet-900"
                >Program*
                <input
                  type="text"
                  name="program"
                  required
                  placeholder="Enter program name (e.g., Bachelor of Science)"
                  class="mt-1 w-full bg-white border border-violet-400 rounded-lg px-4 py-3 shadow-sm text-xl font-sans focus:outline-none focus:ring-2 focus:ring-violet-200 focus:border-violet-400 transition placeholder-violet-300"
                />
              </label>
              <label class="block mb-4 text-lg font-medium text-violet-900"
                >Graduation Year*
                <input
                  type="text"
                  name="graduationYear"
                  required
                  placeholder="Enter graduation year (e.g., 2023)"
                  class="mt-1 w-full bg-white border border-violet-400 rounded-lg px-4 py-3 shadow-sm text-xl font-sans focus:outline-none focus:ring-2 focus:ring-violet-200 focus:border-violet-400 transition placeholder-violet-300"
                />
              </label>
              <label class="block mb-4 text-lg font-medium text-violet-900"
                >Your Internal Reference
                <input
                  type="text"
                  name="reference"
                  class="mt-1 w-full bg-white border border-violet-400 rounded-lg px-4 py-3 shadow-sm text-xl font-sans focus:outline-none focus:ring-2 focus:ring-violet-200 focus:border-violet-400 transition placeholder-violet-300"
                />
              </label>
            </div>
          </div>
          <hr class="my-8 border-violet-700" />
          <div class="mb-8">
            <h3 class="text-2xl font-semibold text-violet-900 mb-4">
              Documents
            </h3>
            <div class="flex flex-col md:flex-row gap-6 justify-between">
              <div class="flex-1 text-center">
                <span class="block font-bold mb-2 text-violet-900"
                  >Consent form*</span
                >
                <div
                  class="bg-white/60 border-2 border-violet-400 rounded-xl p-6 flex flex-col items-center justify-center min-h-[180px] shadow-md"
                >
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    class="h-12 w-12 text-violet-700 mb-2"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke="currentColor"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M7 16v-4a4 4 0 018 0v4m-4-4v8m0 0H5a2 2 0 01-2-2v-2a2 2 0 012-2h14a2 2 0 012 2v2a2 2 0 01-2 2h-6z"
                    />
                  </svg>
                  <label
                    class="cursor-pointer text-violet-600 font-semibold hover:underline"
                  >
                    Select a file to upload
                    <input
                      type="file"
                      name="consentForm"
                      required
                      class="hidden"
                    />
                  </label>
                  <div class="text-xs text-gray-500 mt-2">
                    PDF, JPG, PNG, TIF. Up to 5MB.
                  </div>
                </div>
              </div>
              <div class="flex-1 text-center">
                <span class="block font-bold mb-2 text-violet-900"
                  >Degree holder's ID</span
                >
                <div
                  class="bg-white/60 border-2 border-violet-400 rounded-xl p-6 flex flex-col items-center justify-center min-h-[180px] shadow-md"
                >
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    class="h-12 w-12 text-violet-700 mb-2"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke="currentColor"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M7 16v-4a4 4 0 018 0v4m-4-4v8m0 0H5a2 2 0 01-2-2v-2a2 2 0 012-2h14a2 2 0 012 2v2a2 2 0 01-2 2h-6z"
                    />
                  </svg>
                  <label
                    class="cursor-pointer text-violet-600 font-semibold hover:underline"
                  >
                    Select a file to upload
                    <input type="file" name="degreeId" class="hidden" />
                  </label>
                  <div class="text-xs text-gray-500 mt-2">
                    PDF, JPG, PNG, TIF. Up to 5MB.
                  </div>
                </div>
              </div>
              <div class="flex-1 text-center">
                <span class="block font-bold mb-2 text-violet-900"
                  >Copy of the diploma</span
                >
                <div
                  class="bg-white/60 border-2 border-violet-400 rounded-xl p-6 flex flex-col items-center justify-center min-h-[180px] shadow-md"
                >
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    class="h-12 w-12 text-violet-700 mb-2"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke="currentColor"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M7 16v-4a4 4 0 018 0v4m-4-4v8m0 0H5a2 2 0 01-2-2v-2a2 2 0 012-2h14a2 2 0 012 2v2a2 2 0 01-2 2h-6z"
                    />
                  </svg>
                  <label
                    class="cursor-pointer text-violet-600 font-semibold hover:underline"
                  >
                    Select a file to upload
                    <input type="file" name="diplomaCopy" class="hidden" />
                  </label>
                  <div class="text-xs text-gray-500 mt-2">
                    PDF, JPG, PNG, TIF. Up to 5MB.
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="flex flex-col md:flex-row gap-6 mb-6">
            <div class="flex-1">
              <label class="block text-lg font-medium text-violet-900"
                >Company<input
                  type="text"
                  name="company"
                  class="mt-1 w-full bg-white border border-violet-400 rounded-lg px-4 py-3 shadow-sm text-xl font-sans focus:outline-none focus:ring-2 focus:ring-violet-200 focus:border-violet-400 transition placeholder-violet-300"
              /></label>
            </div>
            <div class="flex-1">
              <label class="block text-lg font-medium text-violet-900"
                >Contact<input
                  type="text"
                  name="contact"
                  class="mt-1 w-full bg-white border border-violet-400 rounded-lg px-4 py-3 shadow-sm text-xl font-sans focus:outline-none focus:ring-2 focus:ring-violet-200 focus:border-violet-400 transition placeholder-violet-300"
              /></label>
            </div>
            <div class="flex-1">
              <label class="block text-lg font-medium text-violet-900"
                >E-mail address<input
                  type="email"
                  name="contactEmail"
                  class="mt-1 w-full bg-white border border-violet-400 rounded-lg px-4 py-3 shadow-sm text-xl font-sans focus:outline-none focus:ring-2 focus:ring-violet-200 focus:border-violet-400 transition placeholder-violet-300"
              /></label>
            </div>
          </div>
          <div class="mb-6">
            <label class="block text-lg font-medium text-violet-900"
              >Comment
              <input
                type="text"
                name="comment"
                class="mt-1 w-full bg-white border border-violet-400 rounded-lg px-4 py-3 shadow-sm text-xl font-sans focus:outline-none focus:ring-2 focus:ring-violet-200 focus:border-violet-400 transition placeholder-violet-300"
              />
            </label>
          </div>
          <div class="flex flex-col md:flex-row gap-4 md:gap-6 mb-6">
           
            <button
              type="submit"
              class="w-full bg-violet-800 text-white px-6 py-3 rounded-lg font-bold text-lg hover:bg-violet-900 transition-colors"
            >
              Submit the verification
            </button>
          </div>
        </form>
      </div>
      <!-- Footer -->
      <footer
        class="w-full py-16 bg-[url('https://images.unsplash.com/photo-1451187580459-43490279c0fa?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=2072&q=80')] bg-cover bg-center relative"
      >
        <!-- Overlay -->
        <div
          class="absolute inset-0 bg-gradient-to-br from-violet-300/55 to-violet-950/95 backdrop-blur-sm"
        ></div>

        <!-- Content -->
        <div class="container mx-auto px-6 relative z-10">
          <div class="grid grid-cols-1 lg:grid-cols-4 gap-12 max-w-7xl mx-auto">
            <!-- Logo & About -->
            <div class="flex flex-col gap-6">
              <div class="flex items-center gap-3 group">
                <div class="relative">
                  <img
                    src="././images/logo-removebg-preview 12.png"
                    alt="SPATRAK Logo"
                    class="h-32 w-32 object-contain transform group-hover:rotate-12 transition duration-300"
                  />
                  <div
                    class="absolute -inset-2 bg-violet-600/30 rounded-full blur-md opacity-0 group-hover:opacity-100 transition duration-500"
                  ></div>
                </div>
                <span class="text-2xl font-bold text-white tracking-wide">
                  SPATRAK
                </span>
              </div>

              <p class="text-violet-200/80 text-sm">
                Leading platform for secure and smart document and certificate
                verification.
              </p>
            </div>

            <!-- Quick Links -->
            <div class="flex flex-col gap-4">
              <h3
                class="text-lg font-semibold text-white mb-2 border-b border-violet-400/30 pb-2"
              >
                Quick Links
              </h3>
              <a href="index.html" class="footer-link">Home</a>
              <a href="././admin-dashboard/dashboard.html" class="footer-link"
                >Dashboard</a
              >
              <a href="state_request.html" class="footer-link">Requests</a>
              <a href="payment.html" class="footer-link">Pricing </a>
              <a href="#contact" class="footer-link">Contact</a>
            </div>

            <!-- Services -->
            <div class="flex flex-col gap-4">
              <h3
                class="text-lg font-semibold text-white mb-2 border-b border-violet-400/30 pb-2"
              >
                Our Services
              </h3>
              <a href="#" class="footer-link">Employer Requests</a>
              <a href="#" class="footer-link">Digital Reports</a>
              <a href="#" class="footer-link">Certificate Validation</a>
              <a href="#" class="footer-link">Document Verification</a>
            </div>

            <!-- Contact & Newsletter -->
            <div class="flex flex-col gap-6">
              <div class="flex flex-col gap-4">
                <h3
                  class="text-lg font-semibold text-white mb-2 border-b border-violet-400/30 pb-2"
                >
                  Contact Us
                </h3>

                <div class="flex items-start gap-3">
                  <!-- <i class="fas fa-envelope text-violet-300 mt-1"></i> -->
                  <a href="mailto:info@spatrak.com" class="footer-link"
                    >info@spatrak.com</a
                  >
                </div>
                <div class="flex items-start gap-3">
                  <!-- <i class="fas fa-envelope text-violet-300 mt-1"></i> -->
                  <a href="mailto:support@spatrak.com" class="footer-link"
                    >support@spatrak.com</a
                  >
                </div>
              </div>
            </div>
          </div>

          <!-- Divider -->
          <div class="border-t border-violet-700/50 my-8"></div>

          <!-- Copyright -->
          <div
            class="flex flex-col md:flex-row justify-between items-center gap-4 text-sm text-violet-300/80"
          >
            <div>
              &copy; 2025 <span class="text-white font-medium">SPATRAK</span>.
              All rights reserved.
            </div>
            <div class="flex gap-6">
              <a href="#" class="hover:text-white transition duration-200"
                >Privacy Policy</a
              >
              <a href="#" class="hover:text-white transition duration-200"
                >Terms of Service</a
              >
              <a href="#" class="hover:text-white transition duration-200"
                >Cookies</a
              >
            </div>
          </div>
        </div>
      </footer>

      <script src="js/script.js"></script>
      <script>
        fetch("./navbar.html")
          .then((response) => response.text())
          .then((data) => {
            document.getElementById("navbar-container").innerHTML = data;
            // Initialize navbar functionality
            loadNavbar();
          });
        fetch("footer.html")
          .then((response) => response.text())
          .then((data) => {
            document.getElementById("footer-container").innerHTML = data;
          });
      </script>
      <script>
        // Helper function to show error messages (assuming this exists or is added elsewhere)
        function showError(element, message) {
          // Basic implementation: create a div and insert it after the element
          const errorDiv = document.createElement("div");
          errorDiv.classList.add(
            "error-message",
            "text-red-500",
            "text-sm",
            "mt-1"
          );
          errorDiv.textContent = message;
          // Find the parent element that contains the label or input
          const parent = element.closest("label") || element.parentElement;
          if (parent) {
            parent.appendChild(errorDiv);
          } else {
            element.parentElement.appendChild(errorDiv);
          }
        }

        // Form validation functions
        function validateName(name) {
          return name.length >= 2 && /^[\u0600-\u06FFa-zA-Z\s]+$/.test(name);
        }

        function validateEmail(email) {
          return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
        }

        function validatePhone(phone) {
          return /^[0-9+\s-]{8,}$/.test(phone);
        }

        function validateDateOfBirth(day, month, year) {
          if (!day || !month || !year) return false;
          const date = new Date(year, month - 1, day);
          return date instanceof Date && !isNaN(date);
        }

        function validateFile(file, maxSize = 5 * 1024 * 1024) {
          if (!file) return true; // Optional files
          const validTypes = [
            // مستندات
            "application/pdf",
            "application/msword",
            "application/vnd.openxmlformats-officedocument.wordprocessingml.document",
            "application/vnd.ms-excel",
            "application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",
            "application/vnd.ms-powerpoint",
            "application/vnd.openxmlformats-officedocument.presentationml.presentation",
            "text/plain",
            "text/csv",

            // صور
            "image/jpeg",
            "image/png",
            "image/gif",
            "image/webp",
            "image/svg+xml",

            // أرشيفات
            "application/zip",
            "application/x-rar-compressed",
            "application/x-7z-compressed",

            // أخرى
            "application/octet-stream", // للنوع العام
          ];
          return validTypes.includes(file.type) && file.size <= maxSize;
        }

        async function submitVerification() {
          // الحصول على عناصر النموذج
          const form = document.getElementById("verificationForm");
          const firstName = form.querySelector('input[name="firstName"]');
          const lastName = form.querySelector('input[name="lastName"]');
          const dobDay = form.querySelector('select[name="dob_day"]');
          const dobMonth = form.querySelector('select[name="dob_month"]');
          const dobYear = form.querySelector('input[name="dob_year"]');
          const email = form.querySelector('input[name="candidateEmail"]');
          const address = form.querySelector('input[name="address"]');
          const phone = form.querySelector('input[name="phone"]');
          const country = form.querySelector('select[name="country"]');
          const establishment = form.querySelector(
            'select[name="establishment"]'
          );
          const program = form.querySelector('select[name="program"]');
          const graduationYear = form.querySelector(
            'select[name="graduationYear"]'
          );
          const reference = form.querySelector('input[name="reference"]');
          const company = form.querySelector('input[name="company"]');
          const contact = form.querySelector('input[name="contact"]');
          const contactEmail = form.querySelector('input[name="contactEmail"]');
          const comment = form.querySelector('input[name="comment"]');
          const consentFormInput = form.querySelector(
            'input[name="consentForm"]'
          );
          const degreeIdInput = form.querySelector('input[name="degreeId"]');
          const diplomaCopyInput = form.querySelector(
            'input[name="diplomaCopy"]'
          );
          var token = sessionStorage.getItem("authToken");
          // إعداد رؤوس الطلب
          const myHeaders = new Headers();
          myHeaders.append("Authorization", `Bearer ${token}`); // NOTE: Hardcoded token - consider a more secure method

          // إنشاء FormData وإضافة البيانات
          const formdata = new FormData();
          formdata.append("firstName", firstName.value);
          formdata.append("lastName", lastName.value);
          formdata.append("birthDateDay", dobDay.value);
          formdata.append("birthDateMonth", dobMonth.value);
          formdata.append("birthDateYear", dobYear.value);
          formdata.append("email", email.value);
          formdata.append("address", address.value);
          formdata.append("phone", phone.value);
          formdata.append("country", country.value);
          formdata.append("establishment", establishment.value);
          formdata.append("program", program.value);
          formdata.append("graduationYear", graduationYear.value);
          formdata.append("internalRef", reference.value);
          formdata.append("company", company.value);
          formdata.append("contact", contact.value);
          formdata.append("contactEmail", contactEmail.value);
          formdata.append("comment", comment.value);

          // إضافة الملفات إذا تم اختيارها
          if (consentFormInput.files.length > 0) {
            formdata.append("consentForm", consentFormInput.files[0]);
          }
          if (degreeIdInput.files.length > 0) {
            formdata.append("idCard", degreeIdInput.files[0]);
          }
          if (diplomaCopyInput.files.length > 0) {
            formdata.append("diploma", diplomaCopyInput.files[0]);
          }

          // إعداد خيارات الطلب
          const requestOptions = {
            method: "POST",
            headers: myHeaders,
            body: formdata,
            redirect: "follow",
          };

          try {
            // Show loading state
            const submitButton = document.querySelector(
              'button[type="submit"]'
            );
            const originalButtonText = submitButton.textContent;
            submitButton.disabled = true;
            submitButton.innerHTML =
              '<i class="fas fa-spinner fa-spin"></i> جاري الإرسال...';

            // إرسال الطلب
            const response = await fetch(
              "https://spatrak.com/api/requests",
              requestOptions
            );
            const result = await response.json();

            if (response.ok) {
              Swal.fire({
                title: "Success!",
                text: "Your Request is Sented successfully ",
                icon: "success",
                confirmButtonText: "OK",
                confirmButtonColor: "#7e22ce",
              });
              form.reset(); // إعادة تعيين النموذج بعد الإرسال الناجح
            } else {
              alert(
                result.message || "فشل في إرسال الطلب. يرجى المحاولة مرة أخرى."
              );
            }
          } catch (error) {
            Swal.fire({
              title: "Error!",
              text: error,
              icon: "error",
              confirmButtonText: "OK",
              confirmButtonColor: "#ef4444",
            });
          } finally {
            // Re-enable button and restore text
            const submitButton = document.querySelector(
              'button[type="submit"]'
            );
            submitButton.disabled = false;
            submitButton.innerHTML = "Submit the verification"; // Or the original text if stored
          }
        }

        // ربط الوظيفة بحدث submit للنموذج
        document
          .getElementById("verificationForm")
          .addEventListener("submit", function (e) {
            e.preventDefault();

            // Reset previous error messages
            document
              .querySelectorAll(".error-message")
              .forEach((el) => el.remove());

            let hasErrors = false;

            // Validate First Name
            const firstName = document.querySelector('input[name="firstName"]');
            if (!validateName(firstName.value)) {
              showError(
                firstName,
                "الرجاء إدخال الاسم الأول بشكل صحيح (حروف فقط)"
              );
              hasErrors = true;
            }

            // Validate Last Name
            const lastName = document.querySelector('input[name="lastName"]');
            if (!validateName(lastName.value)) {
              showError(
                lastName,
                "الرجاء إدخال الاسم الأخير بشكل صحيح (حروف فقط)"
              );
              hasErrors = true;
            }

            // Validate Date of Birth
            const dobDay = document.querySelector('select[name="dob_day"]');
            const dobMonth = document.querySelector('select[name="dob_month"]');
            const dobYear = document.querySelector('input[name="dob_year"]');
            if (
              !validateDateOfBirth(dobDay.value, dobMonth.value, dobYear.value)
            ) {
              showError(dobYear, "الرجاء إدخال تاريخ الميلاد بشكل صحيح"); // Link error to year input
              hasErrors = true;
            }

            // Validate Email if provided
            const email = document.querySelector(
              'input[name="candidateEmail"]'
            );
            if (email.value && !validateEmail(email.value)) {
              showError(email, "الرجاء إدخال البريد الإلكتروني بشكل صحيح");
              hasErrors = true;
            }

            // Validate Phone if provided
            const phone = document.querySelector('input[name="phone"]');
            if (phone.value && !validatePhone(phone.value)) {
              showError(phone, "الرجاء إدخال رقم الهاتف بشكل صحيح");
              hasErrors = true;
            }

            // Validate Required Selects
            const country = document.querySelector('select[name="country"]');
            const establishment = document.querySelector(
              'select[name="establishment"]'
            );
            const program = document.querySelector('select[name="program"]');
            const graduationYear = document.querySelector(
              'select[name="graduationYear"]'
            );

            if (!country.value) {
              showError(country, "الرجاء اختيار الدولة");
              hasErrors = true;
            }
            if (!establishment.value) {
              showError(establishment, "الرجاء اختيار المؤسسة");
              hasErrors = true;
            }
            if (!program.value) {
              showError(program, "الرجاء اختيار البرنامج");
              hasErrors = true;
            }
            if (!graduationYear.value) {
              showError(graduationYear, "الرجاء اختيار سنة التخرج");
              hasErrors = true;
            }

            // Validate Required Files
            const consentFormInput = document.querySelector(
              'input[name="consentForm"]'
            );
            if (consentFormInput.files.length === 0) {
              showError(
                consentFormInput.parentElement,
                "الرجاء تحميل نموذج الموافقة"
              );
              hasErrors = true;
            } else if (!validateFile(consentFormInput.files[0])) {
              showError(
                consentFormInput.parentElement,
                "الرجاء تحميل نموذج الموافقة بصيغة صحيحة (PDF, JPG, PNG, TIF) وحجم لا يتجاوز 5MB"
              );
              hasErrors = true;
            }

            // Validate Optional Files
            const degreeIdInput = document.querySelector(
              'input[name="degreeId"]'
            );
            if (
              degreeIdInput.files.length > 0 &&
              !validateFile(degreeIdInput.files[0])
            ) {
              showError(
                degreeIdInput.parentElement,
                "الرجاء تحميل بطاقة الهوية بصيغة صحيحة (PDF, JPG, PNG, TIF) وحجم لا يتجاوز 5MB"
              );
              hasErrors = true;
            }

            const diplomaCopyInput = document.querySelector(
              'input[name="diplomaCopy"]'
            );
            if (
              diplomaCopyInput.files.length > 0 &&
              !validateFile(diplomaCopyInput.files[0])
            ) {
              showError(
                diplomaCopyInput.parentElement,
                "الرجاء تحميل نسخة الدبلوم بصيغة صحيحة (PDF, JPG, PNG, TIF) وحجم لا يتجاوز 5MB"
              );
              hasErrors = true;
            }

            if (hasErrors) {
              return;
            }

            submitVerification();
          });

        // Helper function to save as draft
        function saveDraft() {
          const form = document.getElementById("verificationForm");
          const formData = new FormData(form);
          const draftData = {};
          for (let [key, value] of formData.entries()) {
            if (value instanceof File) {
              // Handle files differently if needed, e.g., store file names or indicators
              draftData[key] = value.name; // Storing file name as an example
            } else {
              draftData[key] = value;
            }
          }
          localStorage.setItem("verificationDraft", JSON.stringify(draftData));
          alert("تم حفظ المسودة بنجاح");
        }

        // Load draft if exists
        window.addEventListener("load", function () {
          const savedDraft = localStorage.getItem("verificationDraft");
          if (savedDraft) {
            const draftData = JSON.parse(savedDraft);
            Object.keys(draftData).forEach((key) => {
              const element = document.querySelector(`[name="${key}"]`);
              if (element && element.type !== "file") {
                element.value = draftData[key];
              } else if (element && element.type === "file") {
                // Cannot restore file input value directly for security reasons
                console.log(
                  `Draft includes a file for ${key}: ${draftData[key]}. User needs to re-upload.`
                );
                // Optionally, display a message to the user to re-upload the file
              }
            });
          }
        });
      </script>
      <link
        rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
      />
    </div>
  </body>
</html>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    console.log("DOM fully loaded");

    // Check for token and user role in session storage
    const token = sessionStorage.getItem("authToken");
    const userRole = sessionStorage.getItem("userRole");
    const isLoggedIn = !!token;
    const isAdmin = userRole === "admin";

    console.log("Login Status:", isLoggedIn);
    console.log("User Role:", userRole);
    console.log("Is Admin:", isAdmin);

    // Get dropdown elements
    const avatarDropdownBtn = document.getElementById("avatar-dropdown-btn");
    const avatarDropdownMenu = document.getElementById("avatar-dropdown-menu");
    const mobileUserSection = document.getElementById("mobile-user-section");
    const navToggle = document.getElementById("nav-toggle");
    const mobileMenu = document.getElementById("mobile-menu");
    const desktopDashboardLink = document.getElementById(
      "desktop-dashboard-link"
    );
    const mobileDashboardLink = document.getElementById(
      "mobile-dashboard-link"
    );

    // Function to handle Dashboard visibility
    function handleDashboardVisibility() {
      if (isAdmin) {
        // Show Dashboard for admin
        if (desktopDashboardLink)
          desktopDashboardLink.classList.remove("hidden");
        if (mobileDashboardLink) mobileDashboardLink.classList.remove("hidden");
      } else {
        // Hide Dashboard for non-admin users
        if (desktopDashboardLink) desktopDashboardLink.classList.add("hidden");
        if (mobileDashboardLink) mobileDashboardLink.classList.add("hidden");
      }
    }

    // Function to populate dropdown menu based on login status
    function updateDropdownMenus() {
      // Desktop dropdown
      if (isLoggedIn) {
        avatarDropdownMenu.innerHTML = `
          <a href="admin-dashboard/profile.html" class="block px-4 py-2 text-violet-900 hover:bg-violet-50">Profile</a>
          ${
            isAdmin
              ? '<a href="admin-dashboard/dashboard.html" class="block px-4 py-2 text-violet-900 hover:bg-violet-50">Dashboard</a>'
              : ""
          }
          <a href="#" id="sign-out-btn" class="block px-4 py-2 text-violet-900 hover:bg-violet-50">Sign out</a>
        `;
      } else {
        avatarDropdownMenu.innerHTML = `
          <a href="login.html" class="block px-4 py-2 text-violet-900 hover:bg-violet-50">Login</a>
          <a href="register.html" class="block px-4 py-2 text-violet-900 hover:bg-violet-50">Register</a>
        `;
      }

      // Mobile menu user section
      if (isLoggedIn) {
        mobileUserSection.innerHTML = `
          <div class="flex items-center gap-2 px-3 py-2">
            <img
              src="images/Sample_User_Icon.png"
              alt="User"
              class="h-8 w-8 rounded-full border-2 border-violet-300 shadow-sm"
            />
            <span class="text-violet-900 font-semibold">User</span>
          </div>
          <a href="admin-dashboard/profile.html" class="block px-4 py-2 text-violet-900 hover:bg-violet-50">Profile</a>
          ${
            isAdmin
              ? '<a href="admin-dashboard/dashboard.html" class="block px-4 py-2 text-violet-900 hover:bg-violet-50">Dashboard</a>'
              : ""
          }
          <a href="#" id="mobile-sign-out-btn" class="block px-4 py-2 text-violet-900 hover:bg-violet-50">Sign out</a>
        `;
      } else {
        mobileUserSection.innerHTML = `
          <a href="login.html" class="block px-4 py-2 text-violet-900 hover:bg-violet-50">Login</a>
          <a href="register.html" class="block px-4 py-2 text-violet-900 hover:bg-violet-50">Register</a>
        `;
      }

      // Add sign out functionality if logged in
      if (isLoggedIn) {
        const signOutBtn = document.getElementById("sign-out-btn");
        const mobileSignOutBtn = document.getElementById("mobile-sign-out-btn");

        if (signOutBtn) {
          signOutBtn.addEventListener("click", function (e) {
            e.preventDefault();
            sessionStorage.removeItem("authToken");
            sessionStorage.removeItem("IdUser");
            sessionStorage.removeItem("password");
            sessionStorage.removeItem("userRole");
            window.location.href = "index.html";
          });
        }

        if (mobileSignOutBtn) {
          mobileSignOutBtn.addEventListener("click", function (e) {
            e.preventDefault();
            sessionStorage.removeItem("authToken");
            sessionStorage.removeItem("IdUser");
            sessionStorage.removeItem("password");
            sessionStorage.removeItem("userRole");
            window.location.href = "index.html";
          });
        }
      }
    }

    // Initialize menus and handle Dashboard visibility
    updateDropdownMenus();
    handleDashboardVisibility();

    // Toggle dropdown menu on click (for better mobile UX)
    if (avatarDropdownBtn && avatarDropdownMenu) {
      avatarDropdownBtn.addEventListener("click", function () {
        const isVisible = avatarDropdownMenu.classList.contains("opacity-100");

        if (isVisible) {
          avatarDropdownMenu.classList.remove("opacity-100", "visible");
          avatarDropdownMenu.classList.add("opacity-0", "invisible");
        } else {
          avatarDropdownMenu.classList.remove("opacity-0", "invisible");
          avatarDropdownMenu.classList.add("opacity-100", "visible");
        }
      });
    }

    // Close dropdown when clicking outside
    document.addEventListener("click", function (e) {
      if (
        avatarDropdownMenu &&
        avatarDropdownBtn &&
        !avatarDropdownMenu.contains(e.target) &&
        !avatarDropdownBtn.contains(e.target)
      ) {
        avatarDropdownMenu.classList.remove("opacity-100", "visible");
        avatarDropdownMenu.classList.add("opacity-0", "invisible");
      }
    });

    // Mobile menu toggle functionality
    if (navToggle && mobileMenu) {
      function toggleMobileMenu() {
        const isHidden = mobileMenu.classList.contains("hidden");

        if (isHidden) {
          mobileMenu.classList.remove("hidden");
          setTimeout(() => {
            mobileMenu.style.opacity = "1";
            mobileMenu.style.maxHeight = mobileMenu.scrollHeight + "px";
          }, 10);

          navToggle.innerHTML = `
          <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
          </svg>`;
        } else {
          mobileMenu.style.opacity = "0";
          mobileMenu.style.maxHeight = "0";
          setTimeout(() => {
            mobileMenu.classList.add("hidden");
          }, 300);

          navToggle.innerHTML = `
          <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
          </svg>`;
        }
      }

      navToggle.addEventListener("click", function (e) {
        e.stopPropagation();
        e.preventDefault();
        toggleMobileMenu();
      });
    }

    // Contact Form Submission
    const contactForm = document.getElementById("contact-form");
    if (contactForm) {
      contactForm.addEventListener("submit", async function (e) {
        e.preventDefault(); // Prevent default form submission

        const name = document.querySelector(
          '#contact-form input[name="name"]'
        ).value;
        const email = document.querySelector(
          '#contact-form input[name="email"]'
        ).value;
        const messageText = document.querySelector(
          '#contact-form textarea[name="message"]'
        ).value;

        const myHeaders = new Headers();
        myHeaders.append("Content-Type", "application/json");

        const raw = JSON.stringify({
          name: name,
          email: email,
          messageText: messageText,
        });

        const requestOptions = {
          method: "POST",
          headers: myHeaders,
          body: raw,
          redirect: "follow",
        };

        // Basic UI feedback: Disable button and show loading
        const submitButton = contactForm.querySelector('button[type="submit"]');
        const originalButtonText = submitButton.textContent;
        submitButton.disabled = true;
        submitButton.textContent = "Sending...";

        try {
          const response = await fetch(
            "https://spatrak.com/api/requests/contact",
            requestOptions
          );
          const result = await response.text(); // Or response.json() if your API returns JSON
          console.log(result);

          if (response.ok) {
            // Success feedback
            alert("Message sent successfully!");
            contactForm.reset(); // Clear the form
          } else {
            // Error feedback based on response status
            alert(
              `Failed to send message. Status: ${response.status}. Response: ${result}`
            );
          }
        } catch (error) {
          console.error(error);
          // Network error feedback
          alert(
            "An error occurred while sending your message. Please try again."
          );
        } finally {
          // Restore button state
          submitButton.disabled = false;
          submitButton.textContent = originalButtonText;
        }
      });
    }
  });
</script>
